<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Online store with various products" />
    <link
      rel="icon"
      type="image/svg+xml"
      href="../../../../assets/fake-store-app/images/fake-store-app-favicon.svg"
    />
    <link rel="stylesheet" href="./css/style.css" />
    <script src="./js/index.js" defer></script>
    <script src="./js/scripts.js" defer></script>
    <title>Fake Store | Products</title>
    <style>
      .product-category {
        display: inline-block;
        background: #e0e7ff;
        color: var(--primary);
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.85rem;
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <header class="header">
      <nav class="nav-bar">
        <div class="logo">
          <img
            src="../../../../assets/fake-store-app/images/fake-store-app-favicon.svg"
            alt="Logotype-FakeStore"
          />
          FakeStore
        </div>
        <div class="nav-links">
          <a href="./signin/">Signin</a>
          <a href="./signup/">Signup</a>
          <a href="./profile/">Profile</a>
          <a href="./add-product/">Add product</a>
          <a href="./categories">Categories</a>
          <a href="./add-category">Add category</a>
        </div>
        <button class="nav-toggle" aria-label="Menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </nav>
    </header>

    <main class="main-content">
      <h1 class="page-title underline">Products</h1>
      <section class="categories-section">
        <h2 class="section-title">Browse by Category</h2>
        <div class="categories-slider">
          <div class="slider-container">
            <div class="slider-track" id="slider-track">
              <!-- Категории будут добавлены динамически -->
            </div>
            <button class="slider-btn prev" aria-label="Previous Category">
              ❮
            </button>
            <button class="slider-btn next" aria-label="Next Category">
              ❯
            </button>
          </div>
          <div class="slider-dots" id="slider-dots">
            <!-- Точки навигации будут добавлены динамически -->
          </div>
        </div>
      </section>

      <div class="loading-indicator" id="loading">Loading products...</div>

      <ul id="products-list" class="products-list"></ul>
    </main>

    <footer class="footer">
      <div class="footer-content">
        <div class="footer-links">
          <a href="#">About Us</a>
          <a href="#">Contact</a>
          <a href="#">Privacy Policy</a>
        </div>
        <div class="social-links">
          <a href="#" aria-label="Instagram">Instagram</a>
          <a href="#" aria-label="Twitter">Twitter</a>
          <a href="#" aria-label="Facebook">Facebook</a>
        </div>
        <p class="copyright">© 2025 FakeStore. All rights reserved.</p>
      </div>
    </footer>
    <script>
      // Скрипт для слайдера категорий
      document.addEventListener("DOMContentLoaded", () => {
        const sliderTrack = document.getElementById("slider-track");
        const prevBtn = document.querySelector(".slider-btn.prev");
        const nextBtn = document.querySelector(".slider-btn.next");
        const sliderDots = document.getElementById("slider-dots");
        const sliderContainer = document.querySelector(".slider-container");

        let categories = [];
        let currentPosition = 0;
        let slideWidth = 165; // Ширина карточки + gap
        let visibleSlides;

        // Функция для расчета видимых слайдов
        function calculateVisibleSlides() {
          const containerWidth = sliderContainer.clientWidth;
          visibleSlides = Math.floor(containerWidth / slideWidth);
          return visibleSlides;
        }

        // Загрузка категорий с API
        async function loadCategories() {
          try {
            const response = await fetch(
              "https://api.escuelajs.co/api/v1/categories"
            );
            categories = await response.json();
            renderCategories();
            setupSlider();
          } catch (error) {
            console.error("Error loading categories:", error);
            sliderTrack.innerHTML =
              "<p>Failed to load categories. Please try again later.</p>";
          }
        }

        // Отрисовка категорий
        function renderCategories() {
          sliderTrack.innerHTML = "";

          categories.forEach((category) => {
            const card = document.createElement("div");
            card.className = "category-card";
            card.innerHTML = `
            <img src="${
              category.image || "https://placehold.co/600x400"
            }" alt="${category.name}">
            <h3>${category.name}</h3>
          `;
            sliderTrack.appendChild(card);
          });
        }

        // Настройка слайдера
        function setupSlider() {
          calculateVisibleSlides();

          // Показываем кнопки только если есть что скроллить
          if (categories.length > visibleSlides) {
            prevBtn.classList.remove("hidden");
            nextBtn.classList.remove("hidden");
            createDots();
          }

          // Обработчики кнопок
          prevBtn.addEventListener("click", () => {
            currentPosition += slideWidth * Math.min(3, visibleSlides);
            if (currentPosition > 0) currentPosition = 0;
            updateSlider();
          });

          nextBtn.addEventListener("click", () => {
            const maxPosition = -(
              slideWidth *
              (categories.length - visibleSlides)
            );
            currentPosition -= slideWidth * Math.min(3, visibleSlides);
            if (currentPosition < maxPosition) currentPosition = maxPosition;
            updateSlider();
          });

          // Обработка ресайза окна
          window.addEventListener("resize", () => {
            calculateVisibleSlides();
            updateSlider();
          });
        }

        // Создание точек навигации
        function createDots() {
          sliderDots.innerHTML = "";
          const dotCount = Math.ceil(categories.length / visibleSlides);

          for (let i = 0; i < dotCount; i++) {
            const dot = document.createElement("div");
            dot.className = "dot";
            if (i === 0) dot.classList.add("active");

            dot.addEventListener("click", () => {
              currentPosition = -(i * slideWidth * visibleSlides);
              updateSlider();
            });

            sliderDots.appendChild(dot);
          }
        }

        // Обновление позиции слайдера
        function updateSlider() {
          sliderTrack.style.transform = `translateX(${currentPosition}px)`;
          updateDots();
        }

        // Обновление активной точки
        function updateDots() {
          const dots = document.querySelectorAll(".dot");
          const activeIndex = Math.abs(
            Math.round(currentPosition / (slideWidth * visibleSlides))
          );

          dots.forEach((dot, index) => {
            dot.classList.toggle("active", index === activeIndex);
          });
        }

        // Инициализация
        loadCategories();
      });
    </script>
  </body>
</html>
